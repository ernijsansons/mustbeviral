#!/bin/bash
# Pre-push hook - runs before git push

echo "ğŸ” Running pre-push checks..."

# Check if we're in the right directory
if [ ! -f "package.json" ]; then
    echo "âŒ Not in project root directory"
    exit 1
fi

# Check if Node.js and npm are available
if ! command -v node &> /dev/null; then
    echo "âš ï¸ Node.js not found, skipping tests"
    exit 0
fi

if ! command -v npm &> /dev/null; then
    echo "âš ï¸ npm not found, skipping tests"
    exit 0
fi

# Check if dependencies are installed
if [ ! -d "node_modules" ]; then
    echo "âš ï¸ Root dependencies not installed, skipping tests"
    exit 0
fi

if [ ! -d "mustbeviral/node_modules" ]; then
    echo "âš ï¸ mustbeviral dependencies not installed, skipping tests"
    exit 0
fi

echo "âœ… Environment check passed"

# Run linting (non-blocking)
echo "ğŸ” Running linting..."
npm run lint || echo "âš ï¸ Linting issues found (non-blocking)"

# Run type checking (non-blocking)
echo "ğŸ” Running type checking..."
npm run type-check || echo "âš ï¸ Type checking issues found (non-blocking)"

# Run tests (non-blocking to allow push)
echo "ğŸ§ª Running tests..."
npm run test:frontend || echo "âš ï¸ Frontend tests failed (non-blocking)"

echo "âœ… Pre-push checks completed (allowing push)"
exit 0